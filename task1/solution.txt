
1. В административной части сайта создан инфоблок Акции.
Поле Начало активности, Конец активности являются Датой начала акции и Датой конца акции.
Название - Название акции, например: Каждый 3-й товар за 1 руб.
Свойства заполнены у акции:
а) Свойство1 (Количество товаров N) - Тип свойства Число
б) Свойство2 (Цена товара по акции M, руб.) - Тип свойства Число
Акция одна на весь сайта, Активность - Да.
У остальных элементов инфоблока Активность - Нет.

2. Пишем обработчик события Добавления/Изменения товаров в корзине в /local/php_interface/init.php,
который будет пересчитывать стоимости товаров в корзине и в заказе.

Обработчик выполняет следующий алгоритм:

2.1. Проверяем есть ли акция, узнаем ее параметры. Через ORM ищем активный элемент с Активностью - Да.
Проверяем сегодняшнюю дату с периодом активности.
У этого элемента берем необходимые параметры: N - количество товара, M - цена товара по акции.

2.2. Считаем количество товара, к которому нужно применить цену по акции (V).
V = P / N

2.3. Нам известны id товара, цена товара, количество товара, которые мы хотим положить в корзину и
список товаров в корзине можем узнать через методы класса Bitrix\Sale\Basket.
Исходя из этой информации отсортируем массив товаров по цене по возрастанию.
Таким образом, в начале будут товары с наименьшей ценой, к которым будем применять цену по акции.

2.4. Применяем по порядку в цикле цену по акции следующим образом:
Для какого количества товара1 применится скидка NUM_WITH_DISCOUNT1 = NUM1 - M.
Если число отрицательное, то NUM_WITH_DISCOUNT1 = NUM1.
Для товара считаем стоимость = PRICE1 * (NUM1 - NUM_WITH_DISCOUNT1) + M * NUM_WITH_DISCOUNT1
Пересчитываем количество товара, к которому нужно применить акцию с учетом уже изменненных товаров
M = M - NUM_WITH_DISCOUNT1.
Для следующего товара считаем количества товаров, к которым применится скидка NUM_WITH_DISCOUNT2 = NUM2 - M.
Пересчитываем стоимость = PRICE2 * (NUM2 - NUM_WITH_DISCOUNT2) + M * NUM_WITH_DISCOUNT2
Пересчитываем количество товара, к которому нужно применить акцию с учетом уже изменненных товаров
M = M - NUM_WITH_DISCOUNT2.
Если М = 0, останавливаемся.

3. В компонентах корзины и оформления заказа используется вывод товаров из Bitrix\Sale\Basket,
поэтому изменения в логику компонентов вносить не нужно.